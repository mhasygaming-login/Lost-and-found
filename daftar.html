<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pangkalan Masuk - LostFound Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --sidebar-color: #004d4d;
            --accent-green: #00b894;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #000;
            position: relative;
        }

        /* --- SISTEM TRANSMISI DUA LAPISAN (HALUS) --- */
        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -1;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        .bg-layer.active {
            opacity: 1;
            animation: professionalZoom 8s linear forwards;
        }

        @keyframes professionalZoom {
            from { transform: scale(1); }
            to { transform: scale(1.15); }
        }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        /* --- ANIMASI LOADING PROFESIONAL --- */
        #loading-screen {
            position: fixed;
            inset: 0;
            background: var(--sidebar-color);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loader-radar {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .auth-container {
            background: rgba(255, 255, 255, 0.92);
            width: 100%;
            max-width: 420px;
            padding: 50px 40px;
            border-radius: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            text-align: center;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            animation: slideUp 0.8s ease-out;
            z-index: 10;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-logo {
            width: 85px; height: 85px;
            background: var(--sidebar-color);
            color: var(--accent-green);
            border-radius: 22px;
            display: flex; align-items: center; justify-content: center;
            font-size: 42px; margin: 0 auto 25px;
            box-shadow: 0 10px 20px rgba(0, 77, 77, 0.4);
        }

        h2 { color: var(--sidebar-color); margin-bottom: 8px; font-weight: 600; font-size: 26px; }
        p { color: #444; font-size: 13px; margin-bottom: 35px; }

        .input-group { position: relative; margin-bottom: 22px; text-align: left; }
        .input-group i.main-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #aaa; transition: 0.3s; z-index: 2; }

        .input-group input {
            width: 100%;
            padding: 16px 45px 16px 50px;
            border-radius: 15px;
            border: 2px solid #edf2f7;
            outline: none;
            transition: 0.3s;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.7);
        }

        .input-group input:focus { border-color: var(--sidebar-color); background: white; }
        .input-group input:focus ~ i.main-icon { color: var(--accent-green); }

        .toggle-password {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #aaa;
            transition: 0.3s;
            z-index: 2;
        }

        .btn-auth {
            width: 100%; padding: 16px; border: none; border-radius: 15px;
            background: var(--sidebar-color); color: white;
            font-weight: 600; cursor: pointer; transition: 0.3s;
            letter-spacing: 1.5px; margin-top: 10px; font-size: 15px;
            text-transform: uppercase;
        }

        .btn-auth:hover { background: #003333; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0, 77, 77, 0.5); }
        .toggle-auth { margin-top: 30px; font-size: 13px; color: #555; }
        .toggle-auth span { color: var(--sidebar-color); font-weight: 600; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loader-radar"></div>
        <p style="letter-spacing: 3px; font-weight: 300;">SINKRONISASI RADAR...</p>
    </div>

    <div id="bg1" class="bg-layer active"></div>
    <div id="bg2" class="bg-layer"></div>
    <div class="overlay"></div>

    <div class="auth-container">
        <div class="auth-logo"><i class="fa-solid fa-shield-halved"></i></div>
        <h2 id="auth-title">Personel Login</h2>
        <p id="auth-desc">Silakan masuk ke pusat komando radar.</p>

        <form id="authForm">
            <div class="input-group">
                <i class="fa-solid fa-envelope main-icon"></i>
                <input type="email" id="email" placeholder="Intelligence Email" required>
            </div>
            <div class="input-group">
                <i class="fa-solid fa-lock main-icon"></i>
                <input type="password" id="password" placeholder="Passcode" required>
                <i class="fa-solid fa-eye toggle-password" id="eyeIcon"></i>
            </div>
            <button type="submit" class="btn-auth" id="btn-text">ACCESS RADAR</button>
        </form>

        <div class="toggle-auth" id="toggle-text">
            Belum terdaftar? <span id="switchBtn">Daftar Personel Baru</span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCl...", // PASTE KODE ASLI JENDERAL DI SINI
            authDomain: "lostfound-hub-8e41f.firebaseapp.com",
            databaseURL: "https://lostfound-hub-8e41f-default-rtdb.firebaseio.com",
            projectId: "lostfound-hub-8e41f",
            storageBucket: "lostfound-hub-8e41f.appspot.com",
            messagingSenderId: "986701877293",
            appId: "1:986701877293:web:7ae161a3fe466dc283a8a4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let isLoginMode = true;

        // --- BACKGROUND TRANSITION ---
        const images = [
            'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&w=1920&q=80',
            'https://images.unsplash.com/photo-1454496522488-7a8e488e8606?auto=format&fit=crop&w=1920&q=80',
            'https://images.unsplash.com/photo-1483728642387-6c3bdd6c93e5?auto=format&fit=crop&w=1920&q=80',
            'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1920&q=80'
        ];
        let currentIndex = 0;
        const bg1 = document.getElementById('bg1');
        const bg2 = document.getElementById('bg2');
        bg1.style.backgroundImage = `url(${images[0]})`;

        setInterval(() => {
            const nextIndex = (currentIndex + 1) % images.length;
            const activeLayer = currentIndex % 2 === 0 ? bg1 : bg2;
            const nextLayer = currentIndex % 2 === 0 ? bg2 : bg1;
            nextLayer.style.backgroundImage = `url(${images[nextIndex]})`;
            activeLayer.classList.remove('active');
            nextLayer.classList.add('active');
            currentIndex = nextIndex;
        }, 7000);

        // --- FIXED SWITCH LOGIC ---
        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? 'Personel Login' : 'Daftar Personel';
            document.getElementById('auth-desc').innerText = isLoginMode ? 'Silakan masuk ke pusat komando radar.' : 'Daftarkan identitas prajurit baru Anda.';
            document.getElementById('btn-text').innerText = isLoginMode ? 'ACCESS RADAR' : 'CREATE ACCOUNT';
            document.getElementById('switchBtn').innerText = isLoginMode ? 'Daftar Personel Baru' : 'Login Markas';
        };
        document.getElementById('switchBtn').onclick = window.toggleAuthMode;

        // --- SUBMIT DENGAN LOADING ---
        document.getElementById('authForm').onsubmit = async (e) => {
            e.preventDefault();
            const emailValue = document.getElementById('email').value;
            const emailKey = emailValue.replace(/\./g, ','); 
            const pass = document.getElementById('password').value;

            if (isLoginMode) {
                const dbRef = ref(db);
                try {
                    const snapshot = await get(child(dbRef, `users/${emailKey}`));
                    if (snapshot.exists() && snapshot.val().pass === pass) {
                        // Jalankan Animasi Loading
                        document.getElementById('loading-screen').style.display = 'flex';
                        localStorage.setItem('userLogin', emailValue);
                        
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 2000); // Simulasi koneksi satelit 2 detik
                    } else {
                        Swal.fire({ icon: 'error', title: 'GAGAL', text: 'Otorisasi ditolak. Periksa kembali email/passcode.' });
                    }
                } catch (err) { console.error(err); }
            } else {
                await set(ref(db, 'users/' + emailKey), { pass: pass });
                Swal.fire({ icon: 'success', title: 'BERHASIL', text: 'Personel telah terdaftar di pusat.' }).then(() => window.toggleAuthMode());
            }
        };

        // Toggle Password
        document.getElementById('eyeIcon').onclick = () => {
            const p = document.getElementById('password');
            const i = document.getElementById('eyeIcon');
            p.type = p.type === "password" ? "text" : "password";
            i.classList.toggle('fa-eye-slash');
        };
    </script>
</body>
</html>